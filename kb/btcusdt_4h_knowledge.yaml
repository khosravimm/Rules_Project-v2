meta:
  kb_version: 0.1.0
  schema_version: 0.1.0
  project_codename: PrisonBreaker
  symbol: BTCUSDT
  market: BTCUSDT_PERP
  description: 'بانک دانش اولیه BTCUSDT برای تایم‌فریم 4h (به همراه میکروساختار 5m)،
    شامل تعریف دیتاست‌ها، فیچرها و اسکلت خالی برای خوشه‌ها، الگوها، قوانین معاملاتی
    و نتایج بک‌تست. این فایل مطابق KB_SCHEMA.yaml طراحی شده و به‌صورت تدریجی با کشف
    الگوها و اجرای بک‌تست‌ها تکمیل خواهد شد.

    '
  notes:
  - در این نسخه هنوز هیچ الگوی نهایی یا قانون معاملاتی ثبت نشده است.
  - بعد از اجرای data_prep_4h5m و اولین دور pattern mining این فایل باید غنی شود.
  - همه‌ی تغییرات مهم در این فایل باید نسخه‌ی kb_version را افزایش دهد.
  - روابط lead-lag و Cross-Market هنوز ثبت نشده؛ پس از اجرای پایپلاین cross_market_analysis
    و continuous_rebacktest_and_refresh باید market_relations و cross_market_patterns
    تکمیل شود.
  - پایش دوره‌ای و بک‌تست مجدد (پایپلاین continuous_rebacktest_and_refresh) برای به‌روزرسانی
    الگوها، قوانین، backtests و performance_over_time الزامی است.
  timeframe_core: 4h
  version: 0.2.0
  created_at: '2025-12-05'
  updated_at: '2025-12-05'
datasets:
  btcusdt_4h:
    path_raw: data/btcusdt_4h_raw.parquet
    path_features: data/btcusdt_4h_features.parquet
    timeframe: 4h
    rows_raw: 4380
    rows_features: 4380
    exchange_primary: coinex+binance
    loader:
      module: Lib.btc_futures_loader
      function: load_btcusdt_futures_klines
      params:
        timeframe: 4h
        n_candles: 4380
        price_type: latest_price
    notes:
    - Auto-filled or upgraded by upgrade_btcusdt_4h_kb_schema.py
features:
- name: RET_4H
  description: بازده کندل 4 ساعته
  dtype: float
  origin_level: 4h
  formula: close/open - 1
  tags:
  - return
- name: DIR_4H
  description: جهت کندل 4h بر اساس close - open (RET_UP/RET_DOWN)
  dtype: categorical
  origin_level: 4h
  formula: DIR_4H = 'RET_UP' if close > open else 'RET_DOWN'
  tags:
  - direction
  - label
- name: BODY_PCT
  description: نسبت بدنه به کل رنج کندل 4h
  dtype: float
  origin_level: 4h
  formula: abs(close - open) / (high - low + epsilon)
  tags:
  - shape
- name: UPPER_WICK_PCT
  description: نسبت سایه بالایی به رنج کندل 4h
  dtype: float
  origin_level: 4h
  formula: (high - max(open, close)) / (high - low + epsilon)
  tags:
  - shape
- name: LOWER_WICK_PCT
  description: نسبت سایه پایینی به رنج کندل 4h
  dtype: float
  origin_level: 4h
  formula: (min(open, close) - low) / (high - low + epsilon)
  tags:
  - shape
- name: RANGE_PCT
  description: رنج کندل نسبت به قیمت باز
  dtype: float
  origin_level: 4h
  formula: (high - low) / open
  tags:
  - volatility
  - range
- name: VOL_BUCKET_4H
  description: باکت‌بندی اندازه حرکت کندل (کم/متوسط/زیاد)
  dtype: categorical
  origin_level: 4h
  formula: discretization of |RET_4H| into {VOL_LOW, VOL_MID, VOL_HIGH}
  tags:
  - volatility
  - bucket
- name: REGIME_STATE
  description: حالت رژیم بازار (مثلاً بر اساس HMM روی بازده/نوسان)
  dtype: categorical
  origin_level: 4h
  formula: state from regime detection model (e.g., HMM)
  tags:
  - regime
  - state
- name: M5_PATH_TREND_RET
  description: شیب رگرسیون قیمت 5m ها داخل کندل 4h (تمایل روند میکرو)
  dtype: float
  origin_level: aggregated_5m_to_4h
  formula: slope of linear regression of 5m close prices within 4h candle
  tags:
  - microstructure
  - trend
- name: M5_MAX_DRAWDOWN_PCT
  description: بزرگ‌ترین افت (peak-to-trough) داخل مسیر 5m در 4h
  dtype: float
  origin_level: aggregated_5m_to_4h
  formula: max drawdown in percent within all 5m closes inside the 4h candle
  tags:
  - microstructure
  - risk
- name: M5_MAX_RUNUP_PCT
  description: بزرگ‌ترین رشد (trough-to-peak) داخل مسیر 5m در 4h
  dtype: float
  origin_level: aggregated_5m_to_4h
  formula: max runup in percent within all 5m closes inside the 4h candle
  tags:
  - microstructure
  - opportunity
- name: M5_VOLUME_EARLY_FRAC
  description: سهم حجم 1/3 ابتدایی کندل‌های 5m از کل حجم 4h
  dtype: float
  origin_level: aggregated_5m_to_4h
  formula: sum(volume_5m in first 1/3 bars) / sum(volume_5m in all bars of 4h)
  tags:
  - microstructure
  - volume_profile
- name: M5_VOLUME_LATE_FRAC
  description: سهم حجم 1/3 انتهایی کندل‌های 5m از کل حجم 4h
  dtype: float
  origin_level: aggregated_5m_to_4h
  formula: sum(volume_5m in last 1/3 bars) / sum(volume_5m in all bars of 4h)
  tags:
  - microstructure
  - volume_profile
- name: M5_INTRA_VOLATILITY_PCT
  description: نوسان نسبی مسیر 5m داخل 4h (مثلاً std بازده 5m)
  dtype: float
  origin_level: aggregated_5m_to_4h
  formula: std(RET_5M within 4h) or (max-min)/open_4h
  tags:
  - microstructure
  - volatility
- name: RET_5M
  description: بازده کندل 5 دقیقه‌ای
  dtype: float
  origin_level: 5m
  formula: close/open - 1
  tags:
  - return
- name: DIR_5M
  description: جهت کندل 5m (RET_UP/RET_DOWN)
  dtype: categorical
  origin_level: 5m
  formula: DIR_5M = 'RET_UP' if close > open else 'RET_DOWN'
  tags:
  - direction
  - label
- name: BODY_PCT_5M
  description: نسبت بدنه کندل 5m به رنج آن
  dtype: float
  origin_level: 5m
  formula: abs(close - open) / (high - low + epsilon)
  tags:
  - shape
- name: INTRA_4H_INDEX_5M
  description: شماره کندل 5m داخل کندل 4h والد (0,1,2,...)
  dtype: int
  origin_level: 5m
  formula: index of 5m bar within its parent 4h bar
  tags:
  - microstructure
  - position_in_parent
- name: VOL_BUCKET_5M
  description: باکت‌بندی اندازه حرکت کندل 5m (low/mid/high)
  dtype: categorical
  origin_level: 5m
  formula: discretization of |RET_5M| into {VOL_LOW, VOL_MID, VOL_HIGH}
  tags:
  - volatility
  - bucket
clusters: []
patterns:
  dir_sequence_4h:
    description: 4h direction sequence patterns discovered automatically.
    miner:
      name: auto_dir_sequence_miner_v1
      window_lengths:
      - 2
      - 3
      - 4
      - 5
      min_support: 20
      data_range:
        start: '2024-01-01'
        end: '2025-12-01'
    items:
    - id: PAT4H_DIR_L2_001
      name: 2-step direction sequence → RET_UP
      timeframe: 4h
      pattern_type: dir_sequence_forward
      source:
        dataset: btcusdt_4h
        miner: auto_dir_sequence_miner_v1
        discovered_at: '2025-12-05'
        discovered_from: 4h_only
      sequence:
        dirs:
        - DOWN
        - DOWN
        length: 2
      target:
        variable: DIR_4H_NEXT
        favored_class: RET_UP
      stats:
        support: 970
        sample_count: 970
        accuracy: 0.554639175257732
        baseline_accuracy: 0.554639175257732
        lift: 0.0
        avg_ret_next: null
      scoring:
        strength_bucket: medium
        reliability_comment: ''
      lifecycle:
        status: exploratory
        last_evaluated_at: '2025-12-05'
        notes: []
      tags:
      - auto
      - forward
      - dir_sequence
      - length_2
    - id: PAT4H_DIR_L3_002
      name: 3-step direction sequence → RET_UP
      timeframe: 4h
      pattern_type: dir_sequence_forward
      source:
        dataset: btcusdt_4h
        miner: auto_dir_sequence_miner_v1
        discovered_at: '2025-12-05'
        discovered_from: 4h_only
      sequence:
        dirs:
        - DOWN
        - DOWN
        - DOWN
        length: 3
      target:
        variable: DIR_4H_NEXT
        favored_class: RET_UP
      stats:
        support: 432
        sample_count: 432
        accuracy: 0.5763888888888888
        baseline_accuracy: 0.5763888888888888
        lift: 0.0
        avg_ret_next: null
      scoring:
        strength_bucket: medium
        reliability_comment: ''
      lifecycle:
        status: exploratory
        last_evaluated_at: '2025-12-05'
        notes: []
      tags:
      - auto
      - forward
      - dir_sequence
      - length_3
    - id: PAT4H_DIR_L3_003
      name: 3-step direction sequence → RET_UP
      timeframe: 4h
      pattern_type: dir_sequence_forward
      source:
        dataset: btcusdt_4h
        miner: auto_dir_sequence_miner_v1
        discovered_at: '2025-12-05'
        discovered_from: 4h_only
      sequence:
        dirs:
        - UP
        - UP
        - UP
        length: 3
      target:
        variable: DIR_4H_NEXT
        favored_class: RET_UP
      stats:
        support: 513
        sample_count: 513
        accuracy: 0.5536062378167641
        baseline_accuracy: 0.44639376218323584
        lift: 0.10721247563352826
        avg_ret_next: null
      scoring:
        strength_bucket: medium
        reliability_comment: ''
      lifecycle:
        status: candidate
        last_evaluated_at: '2025-12-05T07:19:58Z'
        notes:
        - Promoted to rule RULE4H_DIR_L3_003_LONG on 2025-12-05T07:19:58Z
      tags:
      - auto
      - forward
      - dir_sequence
      - length_3
    - id: PAT4H_DIR_L4_004
      name: 4-step direction sequence → RET_UP
      timeframe: 4h
      pattern_type: dir_sequence_forward
      source:
        dataset: btcusdt_4h
        miner: auto_dir_sequence_miner_v1
        discovered_at: '2025-12-05'
        discovered_from: 4h_only
      sequence:
        dirs:
        - DOWN
        - DOWN
        - DOWN
        - DOWN
        length: 4
      target:
        variable: DIR_4H_NEXT
        favored_class: RET_UP
      stats:
        support: 183
        sample_count: 183
        accuracy: 0.5956284153005464
        baseline_accuracy: 0.5956284153005464
        lift: 0.0
        avg_ret_next: null
      scoring:
        strength_bucket: strong
        reliability_comment: ''
      lifecycle:
        status: exploratory
        last_evaluated_at: '2025-12-05'
        notes: []
      tags:
      - auto
      - forward
      - dir_sequence
      - length_4
    - id: PAT4H_DIR_L4_005
      name: 4-step direction sequence → RET_UP
      timeframe: 4h
      pattern_type: dir_sequence_forward
      source:
        dataset: btcusdt_4h
        miner: auto_dir_sequence_miner_v1
        discovered_at: '2025-12-05'
        discovered_from: 4h_only
      sequence:
        dirs:
        - DOWN
        - DOWN
        - UP
        - DOWN
        length: 4
      target:
        variable: DIR_4H_NEXT
        favored_class: RET_UP
      stats:
        support: 267
        sample_count: 267
        accuracy: 0.5692883895131086
        baseline_accuracy: 0.5692883895131086
        lift: 0.0
        avg_ret_next: null
      scoring:
        strength_bucket: medium
        reliability_comment: ''
      lifecycle:
        status: exploratory
        last_evaluated_at: '2025-12-05'
        notes: []
      tags:
      - auto
      - forward
      - dir_sequence
      - length_4
    - id: PAT4H_DIR_L4_006
      name: 4-step direction sequence → RET_UP
      timeframe: 4h
      pattern_type: dir_sequence_forward
      source:
        dataset: btcusdt_4h
        miner: auto_dir_sequence_miner_v1
        discovered_at: '2025-12-05'
        discovered_from: 4h_only
      sequence:
        dirs:
        - DOWN
        - UP
        - UP
        - UP
        length: 4
      target:
        variable: DIR_4H_NEXT
        favored_class: RET_UP
      stats:
        support: 284
        sample_count: 284
        accuracy: 0.5845070422535211
        baseline_accuracy: 0.4154929577464789
        lift: 0.16901408450704225
        avg_ret_next: null
      scoring:
        strength_bucket: medium
        reliability_comment: ''
      lifecycle:
        status: exploratory
        last_evaluated_at: '2025-12-05'
        notes: []
      tags:
      - auto
      - forward
      - dir_sequence
      - length_4
    - id: PAT4H_DIR_L4_007
      name: 4-step direction sequence → RET_UP
      timeframe: 4h
      pattern_type: dir_sequence_forward
      source:
        dataset: btcusdt_4h
        miner: auto_dir_sequence_miner_v1
        discovered_at: '2025-12-05'
        discovered_from: 4h_only
      sequence:
        dirs:
        - UP
        - DOWN
        - DOWN
        - DOWN
        length: 4
      target:
        variable: DIR_4H_NEXT
        favored_class: RET_UP
      stats:
        support: 249
        sample_count: 249
        accuracy: 0.5622489959839357
        baseline_accuracy: 0.5622489959839357
        lift: 0.0
        avg_ret_next: null
      scoring:
        strength_bucket: medium
        reliability_comment: ''
      lifecycle:
        status: candidate
        last_evaluated_at: '2025-12-05T07:19:58Z'
        notes:
        - Promoted to rule RULE4H_DIR_L4_007_LONG on 2025-12-05T07:19:58Z
      tags:
      - auto
      - forward
      - dir_sequence
      - length_4
    - id: PAT4H_DIR_L5_008
      name: 5-step direction sequence → RET_UP
      timeframe: 4h
      pattern_type: dir_sequence_forward
      source:
        dataset: btcusdt_4h
        miner: auto_dir_sequence_miner_v1
        discovered_at: '2025-12-05'
        discovered_from: 4h_only
      sequence:
        dirs:
        - DOWN
        - DOWN
        - DOWN
        - DOWN
        - DOWN
        length: 5
      target:
        variable: DIR_4H_NEXT
        favored_class: RET_UP
      stats:
        support: 74
        sample_count: 74
        accuracy: 0.6216216216216216
        baseline_accuracy: 0.6216216216216216
        lift: 0.0
        avg_ret_next: null
      scoring:
        strength_bucket: strong
        reliability_comment: ''
      lifecycle:
        status: exploratory
        last_evaluated_at: '2025-12-05'
        notes: []
      tags:
      - auto
      - forward
      - dir_sequence
      - length_5
    - id: PAT4H_DIR_L5_009
      name: 5-step direction sequence → RET_UP
      timeframe: 4h
      pattern_type: dir_sequence_forward
      source:
        dataset: btcusdt_4h
        miner: auto_dir_sequence_miner_v1
        discovered_at: '2025-12-05'
        discovered_from: 4h_only
      sequence:
        dirs:
        - DOWN
        - DOWN
        - DOWN
        - UP
        - DOWN
        length: 5
      target:
        variable: DIR_4H_NEXT
        favored_class: RET_UP
      stats:
        support: 130
        sample_count: 130
        accuracy: 0.5923076923076923
        baseline_accuracy: 0.5923076923076923
        lift: 0.0
        avg_ret_next: null
      scoring:
        strength_bucket: medium
        reliability_comment: ''
      lifecycle:
        status: exploratory
        last_evaluated_at: '2025-12-05'
        notes: []
      tags:
      - auto
      - forward
      - dir_sequence
      - length_5
    - id: PAT4H_DIR_L5_010
      name: 5-step direction sequence → RET_UP
      timeframe: 4h
      pattern_type: dir_sequence_forward
      source:
        dataset: btcusdt_4h
        miner: auto_dir_sequence_miner_v1
        discovered_at: '2025-12-05'
        discovered_from: 4h_only
      sequence:
        dirs:
        - DOWN
        - DOWN
        - UP
        - DOWN
        - DOWN
        length: 5
      target:
        variable: DIR_4H_NEXT
        favored_class: RET_UP
      stats:
        support: 115
        sample_count: 115
        accuracy: 0.591304347826087
        baseline_accuracy: 0.591304347826087
        lift: 0.0
        avg_ret_next: null
      scoring:
        strength_bucket: medium
        reliability_comment: ''
      lifecycle:
        status: exploratory
        last_evaluated_at: '2025-12-05'
        notes: []
      tags:
      - auto
      - forward
      - dir_sequence
      - length_5
    - id: PAT4H_DIR_L5_011
      name: 5-step direction sequence → RET_UP
      timeframe: 4h
      pattern_type: dir_sequence_forward
      source:
        dataset: btcusdt_4h
        miner: auto_dir_sequence_miner_v1
        discovered_at: '2025-12-05'
        discovered_from: 4h_only
      sequence:
        dirs:
        - DOWN
        - DOWN
        - UP
        - UP
        - DOWN
        length: 5
      target:
        variable: DIR_4H_NEXT
        favored_class: RET_UP
      stats:
        support: 136
        sample_count: 136
        accuracy: 0.5955882352941176
        baseline_accuracy: 0.5955882352941176
        lift: 0.0
        avg_ret_next: null
      scoring:
        strength_bucket: strong
        reliability_comment: ''
      lifecycle:
        status: exploratory
        last_evaluated_at: '2025-12-05'
        notes: []
      tags:
      - auto
      - forward
      - dir_sequence
      - length_5
    - id: PAT4H_DIR_L5_012
      name: 5-step direction sequence → RET_UP
      timeframe: 4h
      pattern_type: dir_sequence_forward
      source:
        dataset: btcusdt_4h
        miner: auto_dir_sequence_miner_v1
        discovered_at: '2025-12-05'
        discovered_from: 4h_only
      sequence:
        dirs:
        - DOWN
        - DOWN
        - UP
        - UP
        - UP
        length: 5
      target:
        variable: DIR_4H_NEXT
        favored_class: RET_UP
      stats:
        support: 134
        sample_count: 134
        accuracy: 0.582089552238806
        baseline_accuracy: 0.417910447761194
        lift: 0.16417910447761197
        avg_ret_next: null
      scoring:
        strength_bucket: medium
        reliability_comment: ''
      lifecycle:
        status: exploratory
        last_evaluated_at: '2025-12-05'
        notes: []
      tags:
      - auto
      - forward
      - dir_sequence
      - length_5
    - id: PAT4H_DIR_L5_013
      name: 5-step direction sequence → RET_UP
      timeframe: 4h
      pattern_type: dir_sequence_forward
      source:
        dataset: btcusdt_4h
        miner: auto_dir_sequence_miner_v1
        discovered_at: '2025-12-05'
        discovered_from: 4h_only
      sequence:
        dirs:
        - DOWN
        - UP
        - DOWN
        - DOWN
        - DOWN
        length: 5
      target:
        variable: DIR_4H_NEXT
        favored_class: RET_UP
      stats:
        support: 129
        sample_count: 129
        accuracy: 0.5658914728682171
        baseline_accuracy: 0.5658914728682171
        lift: 0.0
        avg_ret_next: null
      scoring:
        strength_bucket: medium
        reliability_comment: ''
      lifecycle:
        status: exploratory
        last_evaluated_at: '2025-12-05'
        notes: []
      tags:
      - auto
      - forward
      - dir_sequence
      - length_5
    - id: PAT4H_DIR_L5_014
      name: 5-step direction sequence → RET_UP
      timeframe: 4h
      pattern_type: dir_sequence_forward
      source:
        dataset: btcusdt_4h
        miner: auto_dir_sequence_miner_v1
        discovered_at: '2025-12-05'
        discovered_from: 4h_only
      sequence:
        dirs:
        - DOWN
        - UP
        - DOWN
        - DOWN
        - UP
        length: 5
      target:
        variable: DIR_4H_NEXT
        favored_class: RET_UP
      stats:
        support: 149
        sample_count: 149
        accuracy: 0.5637583892617449
        baseline_accuracy: 0.5637583892617449
        lift: 0.0
        avg_ret_next: null
      scoring:
        strength_bucket: medium
        reliability_comment: ''
      lifecycle:
        status: exploratory
        last_evaluated_at: '2025-12-05'
        notes: []
      tags:
      - auto
      - forward
      - dir_sequence
      - length_5
    - id: PAT4H_DIR_L5_015
      name: 5-step direction sequence → RET_UP
      timeframe: 4h
      pattern_type: dir_sequence_forward
      source:
        dataset: btcusdt_4h
        miner: auto_dir_sequence_miner_v1
        discovered_at: '2025-12-05'
        discovered_from: 4h_only
      sequence:
        dirs:
        - DOWN
        - UP
        - UP
        - UP
        - DOWN
        length: 5
      target:
        variable: DIR_4H_NEXT
        favored_class: RET_UP
      stats:
        support: 166
        sample_count: 166
        accuracy: 0.5783132530120482
        baseline_accuracy: 0.5783132530120482
        lift: 0.0
        avg_ret_next: null
      scoring:
        strength_bucket: medium
        reliability_comment: ''
      lifecycle:
        status: exploratory
        last_evaluated_at: '2025-12-05'
        notes: []
      tags:
      - auto
      - forward
      - dir_sequence
      - length_5
    - id: PAT4H_DIR_L5_016
      name: 5-step direction sequence → RET_UP
      timeframe: 4h
      pattern_type: dir_sequence_forward
      source:
        dataset: btcusdt_4h
        miner: auto_dir_sequence_miner_v1
        discovered_at: '2025-12-05'
        discovered_from: 4h_only
      sequence:
        dirs:
        - UP
        - DOWN
        - DOWN
        - DOWN
        - DOWN
        length: 5
      target:
        variable: DIR_4H_NEXT
        favored_class: RET_UP
      stats:
        support: 109
        sample_count: 109
        accuracy: 0.5779816513761468
        baseline_accuracy: 0.5779816513761468
        lift: 0.0
        avg_ret_next: null
      scoring:
        strength_bucket: medium
        reliability_comment: ''
      lifecycle:
        status: exploratory
        last_evaluated_at: '2025-12-05'
        notes: []
      tags:
      - auto
      - forward
      - dir_sequence
      - length_5
    - id: PAT4H_DIR_L5_017
      name: 5-step direction sequence → RET_UP
      timeframe: 4h
      pattern_type: dir_sequence_forward
      source:
        dataset: btcusdt_4h
        miner: auto_dir_sequence_miner_v1
        discovered_at: '2025-12-05'
        discovered_from: 4h_only
      sequence:
        dirs:
        - UP
        - DOWN
        - DOWN
        - DOWN
        - UP
        length: 5
      target:
        variable: DIR_4H_NEXT
        favored_class: RET_UP
      stats:
        support: 140
        sample_count: 140
        accuracy: 0.55
        baseline_accuracy: 0.45
        lift: 0.10000000000000003
        avg_ret_next: null
      scoring:
        strength_bucket: medium
        reliability_comment: ''
      lifecycle:
        status: exploratory
        last_evaluated_at: '2025-12-05'
        notes: []
      tags:
      - auto
      - forward
      - dir_sequence
      - length_5
    - id: PAT4H_DIR_L5_018
      name: 5-step direction sequence → RET_UP
      timeframe: 4h
      pattern_type: dir_sequence_forward
      source:
        dataset: btcusdt_4h
        miner: auto_dir_sequence_miner_v1
        discovered_at: '2025-12-05'
        discovered_from: 4h_only
      sequence:
        dirs:
        - UP
        - DOWN
        - UP
        - UP
        - UP
        length: 5
      target:
        variable: DIR_4H_NEXT
        favored_class: RET_UP
      stats:
        support: 150
        sample_count: 150
        accuracy: 0.5866666666666667
        baseline_accuracy: 0.41333333333333333
        lift: 0.17333333333333334
        avg_ret_next: null
      scoring:
        strength_bucket: medium
        reliability_comment: ''
      lifecycle:
        status: exploratory
        last_evaluated_at: '2025-12-05'
        notes: []
      tags:
      - auto
      - forward
      - dir_sequence
      - length_5
    - id: PAT4H_DIR_L5_019
      name: 5-step direction sequence → RET_UP
      timeframe: 4h
      pattern_type: dir_sequence_forward
      source:
        dataset: btcusdt_4h
        miner: auto_dir_sequence_miner_v1
        discovered_at: '2025-12-05'
        discovered_from: 4h_only
      sequence:
        dirs:
        - UP
        - UP
        - DOWN
        - DOWN
        - DOWN
        length: 5
      target:
        variable: DIR_4H_NEXT
        favored_class: RET_UP
      stats:
        support: 120
        sample_count: 120
        accuracy: 0.5583333333333333
        baseline_accuracy: 0.5583333333333333
        lift: 0.0
        avg_ret_next: null
      scoring:
        strength_bucket: medium
        reliability_comment: ''
      lifecycle:
        status: exploratory
        last_evaluated_at: '2025-12-05'
        notes: []
      tags:
      - auto
      - forward
      - dir_sequence
      - length_5
trading_rules:
  rules:
  - id: RULE4H_DIR_L3_003_LONG
    name: 4h pattern PAT4H_DIR_L3_003 → LONG
    timeframe: 4h
    direction: long
    pattern_refs:
    - PAT4H_DIR_L3_003
    logic:
      entry:
        description: Enter LONG after pattern PAT4H_DIR_L3_003 fires.
        conditions:
        - Last N 4h DIR_4H matches the sequence from pattern PAT4H_DIR_L3_003.
        - No conflicting higher-priority risk constraint.
      exit:
        description: Initial generic exit; must be refined via backtesting.
        stop_loss:
          type: percent
          value: 0.02
        take_profit:
          type: rr
          rr: 2.0
        time_based:
          max_bars_hold: 4
    risk:
      max_risk_per_trade_pct: 1.0
      leverage: 10
      notes: []
    lifecycle:
      status: draft
      created_at: '2025-12-05T07:19:58Z'
      updated_at: '2025-12-05T07:19:58Z'
      notes:
      - Rule created from pattern PAT4H_DIR_L3_003 with direction=long.
    tags:
    - auto_pattern_based
    - btc_4h
    - dir_sequence
    - pattern_id:PAT4H_DIR_L3_003
    - direction:long
  - id: RULE4H_DIR_L4_007_LONG
    name: 4h pattern PAT4H_DIR_L4_007 → LONG
    timeframe: 4h
    direction: long
    pattern_refs:
    - PAT4H_DIR_L4_007
    logic:
      entry:
        description: Enter LONG after pattern PAT4H_DIR_L4_007 fires.
        conditions:
        - Last N 4h DIR_4H matches the sequence from pattern PAT4H_DIR_L4_007.
        - No conflicting higher-priority risk constraint.
      exit:
        description: Initial generic exit; must be refined via backtesting.
        stop_loss:
          type: percent
          value: 0.02
        take_profit:
          type: rr
          rr: 2.0
        time_based:
          max_bars_hold: 4
    risk:
      max_risk_per_trade_pct: 1.0
      leverage: 10
      notes: []
    lifecycle:
      status: draft
      created_at: '2025-12-05T07:19:58Z'
      updated_at: '2025-12-05T07:19:58Z'
      notes:
      - Rule created from pattern PAT4H_DIR_L4_007 with direction=long.
    tags:
    - auto_pattern_based
    - btc_4h
    - dir_sequence
    - pattern_id:PAT4H_DIR_L4_007
    - direction:long
rule_relations: []
cross_market_patterns: []
market_relations: []
backtests: []
performance_over_time: []
status_history: []
